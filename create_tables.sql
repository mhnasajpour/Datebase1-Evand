--drop table Star
--drop table Comment
--drop table Staff
--drop table Social_media
--drop table Message
--drop table Ticket
--drop table Discount
--drop table Event
--drop table "User"
--drop table Organizer
--drop table Member
--drop table Category


CREATE TABLE CATEGORY
  (
     TITLE NVARCHAR(50) PRIMARY KEY,
     DESCRIPTION NVARCHAR(500) NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate()
  );

CREATE TABLE MEMBER
  (
     MEMBER_ID INT IDENTITY(1, 1) PRIMARY KEY,
     EMAIL VARCHAR(50) UNIQUE NOT NULL CHECK(EMAIL LIKE '%@%.%'),
     PASSWORD VARCHAR(50) NOT NULL,
     PHONE_NUMBER VARCHAR(11) NULL CHECK(PHONE_NUMBER LIKE '09%' AND Len(PHONE_NUMBER) = 11),
     THUMBNAIL NVARCHAR(MAX) NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate()
  );

CREATE TABLE ORGANIZER
  (
     ORGANIZER_ID INT PRIMARY KEY,
     NAME NVARCHAR(50) UNIQUE NOT NULL,
     DESCRIPTION NVARCHAR(500) NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY (ORGANIZER_ID) REFERENCES MEMBER(MEMBER_ID)
  );

CREATE TABLE "USER"
  (
     "USER_ID" INT PRIMARY KEY,
     FIRST_NAME NVARCHAR(50) NOT NULL,
     LAST_NAME NVARCHAR(50) NOT NULL,
     BIRTH_DATE DATE NULL CHECK(BIRTH_DATE < Getdate()),
     PROVINCE NVARCHAR(50) NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY ("USER_ID") REFERENCES MEMBER(MEMBER_ID)
  );

CREATE TABLE EVENT
  (
     EVENT_ID INT PRIMARY KEY,
     CATEGORY NVARCHAR(50) NULL,
     ORGANIZER_ID INT NOT NULL,
     NAME NVARCHAR(50) NOT NULL,
     PRICE DECIMAL(12, 3) NULL CHECK(PRICE >= 0),
     PLACE NVARCHAR(50) NULL,
     TYPE NVARCHAR(15) NOT NULL CHECK(TYPE IN ('Attendance', 'Non-Attendance', 'Both')),
     DESCRIPTION NVARCHAR(500) NULL,
     EXP_REGISTRATION DATETIME NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY (EVENT_ID) REFERENCES MEMBER(MEMBER_ID),
     FOREIGN KEY (CATEGORY) REFERENCES CATEGORY(TITLE),
     FOREIGN KEY (ORGANIZER_ID) REFERENCES ORGANIZER(ORGANIZER_ID)
  );

CREATE TABLE SOCIAL_MEDIA
  (
     MEMBER_ID INT,NAME NVARCHAR(10) CHECK(NAME IN ('Website', 'Linkedin', 'Telegram', 'Instagram', 'WhatsApp', 'Twitter', 'Skype', 'Facebook', 'Github')),
     LINK NVARCHAR(100) NOT NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     PRIMARY KEY (MEMBER_ID, NAME),
     FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER(MEMBER_ID)
  );

CREATE TABLE MESSAGE
  (
     MESSAGE_ID INT IDENTITY(1, 1) PRIMARY KEY,
     MEMBER_ID INT NOT NULL,
     TEXT NVARCHAR(500) NOT NULL,
     IS_SEEN BIT NOT NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER(MEMBER_ID)
  );

CREATE TABLE DISCOUNT
  (
     CODE NVARCHAR(20) PRIMARY KEY,
     EVENT_ID INT NOT NULL,
     "PERCENT" DECIMAL(2, 0) NOT NULL CHECK("PERCENT" >= 0),
     EXP_DATE DATETIME NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID)
  );

CREATE TABLE STAFF
  (
     "USER_ID" INT,
     EVENT_ID INT,
     ROLL NVARCHAR(50) NULL,
     IS_ADMIN BIT NOT NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     PRIMARY KEY ("USER_ID", EVENT_ID),
     FOREIGN KEY ("USER_ID") REFERENCES "USER"("USER_ID"),
     FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID)
  );

CREATE TABLE TICKET
  (
     SERIAL_NUMBER NVARCHAR(20) PRIMARY KEY,
     "USER_ID" INT NOT NULL,
     EVENT_ID INT NOT NULL,
     DISCOUNT_CODE NVARCHAR(20) NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY ("USER_ID") REFERENCES "USER"("USER_ID"),
     FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID),
     FOREIGN KEY (DISCOUNT_CODE) REFERENCES DISCOUNT(CODE)
  );

CREATE TABLE COMMENT
  (
     COMMENT_ID INT IDENTITY(1, 1) PRIMARY KEY,
     "USER_ID" INT NOT NULL,
	 EVENT_ID INT NOT NULL,
     TEXT NVARCHAR(500) NOT NULL,
     IS_ENABLED BIT NOT NULL,
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     FOREIGN KEY ("USER_ID") REFERENCES "USER"("USER_ID"),
     FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID)
  );

CREATE TABLE STAR
  (
     "USER_ID" INT,EVENT_ID INT,RATE DECIMAL(2, 1) NOT NULL CHECK(RATE BETWEEN 0 AND 5),
     DATE_CREATED DATETIME DEFAULT Getdate(),
     DATE_UPDATED DATETIME DEFAULT Getdate(),
     PRIMARY KEY ("USER_ID", EVENT_ID),
     FOREIGN KEY ("USER_ID") REFERENCES "USER"("USER_ID"),
     FOREIGN KEY (EVENT_ID) REFERENCES EVENT(EVENT_ID)
  );

INSERT INTO CATEGORY
            (TITLE)
VALUES      ('Educational');

INSERT INTO CATEGORY
            (TITLE)
VALUES      ('Sports');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER,THUMBNAIL)
VALUES      ('mhnasajpour@gmail.com','dfg64f','09134596626','/images/pic1');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER,THUMBNAIL)
VALUES      ('danny@gmail.com','ikjhgb666','09135649685','/images/pic2');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER)
VALUES      ('melika@gmail.com','jhgf7d6sa54','09107826623');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER,THUMBNAIL)
VALUES      ('shayan@gmail.com','fdytjdfg898','09107860245','/images/pic3');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER)
VALUES      ('hellohackers@gmail.com','abcf767454','09387860245');

INSERT INTO MEMBER
            (EMAIL,PASSWORD,PHONE_NUMBER,THUMBNAIL)
VALUES      ('aicup@gmail.com','ikqb0086','09453671085','/images/pic4');

INSERT INTO ORGANIZER
            (ORGANIZER_ID,NAME)
VALUES      (3,'Isfahan university of technology');

INSERT INTO ORGANIZER
            (ORGANIZER_ID,NAME)
VALUES      (4,'Sepahan');

INSERT INTO "USER"
            ("USER_ID",FIRST_NAME,LAST_NAME,BIRTH_DATE)
VALUES      (1,'Mohammad','Nasajpour','2002-03-27');

INSERT INTO "USER"
            ("USER_ID",FIRST_NAME,LAST_NAME)
VALUES      (2,'Danial','Khorasanizadeh');

INSERT INTO EVENT
            (EVENT_ID,CATEGORY,ORGANIZER_ID,NAME,TYPE,PRICE)
VALUES      (5,'Educational',3,'Hello Hackers','Non-Attendance',100000);

INSERT INTO EVENT
            (EVENT_ID,CATEGORY,ORGANIZER_ID,NAME,TYPE,PRICE)
VALUES      (6,'Educational',3,'AICup','Attendance',200000);

INSERT INTO SOCIAL_MEDIA
            (MEMBER_ID,NAME,LINK)
VALUES      (1,'Telegram','@mhnasajpour');

INSERT INTO SOCIAL_MEDIA
            (MEMBER_ID,NAME,LINK)
VALUES      (3,'Linkedin','linkedin.com/in/fotoohi/');

INSERT INTO MESSAGE
            (MEMBER_ID,TEXT,IS_SEEN)
VALUES      (1,'Welome to Evand',1);

INSERT INTO MESSAGE
            (MEMBER_ID,TEXT,IS_SEEN)
VALUES      (2,'How can i help you?',0);

INSERT INTO DISCOUNT
            (CODE,EVENT_ID,"PERCENT")
VALUES      ('6s7d8f5',5,50);

INSERT INTO DISCOUNT
            (CODE,EVENT_ID,"PERCENT",EXP_DATE)
VALUES      ('uihngbd',5,85,Dateadd(DAY, 7, Getdate()));

INSERT INTO STAFF
            ("USER_ID",EVENT_ID,ROLL,IS_ADMIN)
VALUES      (1,6,'HR',0);

INSERT INTO STAFF
            ("USER_ID",EVENT_ID,ROLL,IS_ADMIN)
VALUES      (2,5,'CTO',1);

INSERT INTO TICKET
            (SERIAL_NUMBER,"USER_ID",EVENT_ID,DISCOUNT_CODE)
VALUES      ('avnkewrj',1,5,'6s7d8f5');

INSERT INTO TICKET
            (SERIAL_NUMBER,"USER_ID",EVENT_ID)
VALUES      ('utjfkoif',2,6);

INSERT INTO COMMENT
            ("USER_ID",EVENT_ID,TEXT,IS_ENABLED)
VALUES      (1,5,'It was very good',1);

INSERT INTO COMMENT
            ("USER_ID",EVENT_ID,TEXT,IS_ENABLED)
VALUES      (2,5,'What was this shit',0);

INSERT INTO STAR
            ("USER_ID",EVENT_ID,RATE)
VALUES      (1,5,4.5);

INSERT INTO STAR
            ("USER_ID",EVENT_ID,RATE)
VALUES      (2,5,1); 